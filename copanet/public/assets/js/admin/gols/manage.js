// Generated by CoffeeScript 1.4.0

define(['jquery', 'index', 'jquery.migrate', 'form'], function($, Index) {
  Index = Index || {};
  Index.Admin = (function(Admin) {
    Admin.manage = (function() {
      var bindEvents, getForm, getTimes, __addButton, __artilheiroSelect, __departamentoSelect, __editButton, __formElement, __formModal, __itemClass, __saveButton, __timeSelect, _triggerAjaxForm, _triggerSelects;
      __formModal = '';
      __formElement = 'form.modal-form';
      __itemClass = '.item';
      __addButton = '.btn-add';
      __editButton = '.btn-edit';
      __saveButton = '.btn-save-widget';
      __departamentoSelect = '.departamento-select';
      __timeSelect = '.time-select';
      __artilheiroSelect = '.artilheiro-select';
      getForm = function(target) {
        return $.ajax({
          beforeSend: function() {
            return Index.uiBlocker();
          },
          url: target.attr('href'),
          type: 'GET',
          dataType: 'html'
        }).done(function(data) {
          var modal;
          if (data === 'undefined' || data === '') {
            return false;
          }
          modal = $(Index.modals.widgetForm);
          $(modal).find('#modalBody').html(data);
          $(modal).find('#modalLabel').html('Adicionar Gols');
          $(modal).modal();
          __formModal = modal;
          $(__formModal).on('hidden', function() {
            return $(this).remove('.modal');
          });
          _triggerAjaxForm();
          return _triggerSelects();
        }).always(function() {
          return Index.uiBlocker();
        });
      };
      _triggerAjaxForm = function() {
        return $(__formModal).find(__formElement).ajaxForm({
          beforeSubmit: function() {
            return Index.uiBlocker();
          },
          success: function(data) {
            Index.uiBlocker();
            return $(__formModal).modal('hide');
          },
          error: function() {
            return Index.uiBlocker();
          }
        });
      };
      _triggerSelects = function() {
        return $(__formModal).find(__departamentoSelect).bind('change', function() {
          return getTimes($(this).children('option:selected'));
        });
      };
      getTimes = function(departamento) {
        return $.ajax({
          beforeSend: function() {
            return Index.uiBlocker();
          },
          url: departamento.data('url'),
          type: 'GET',
          dataType: 'html'
        }).done(function(data) {
          if (data === 'undefined' || data === '') {
            return false;
          }
          return $(__timeSelect).empty().html(data);
        }).always(function() {
          return Index.uiBlocker();
        });
      };
      bindEvents = function() {
        $(__addButton).bind('click', function(event) {
          event.preventDefault();
          return getForm($(this));
        });
        return $(__saveButton).live('click', function(event) {
          return $(__formModal).find(__formElement).submit();
        });
      };
      return {
        init: function() {
          return bindEvents();
        }
      };
    })();
    return Admin;
  })(Index || {});
  return $(function() {
    return Index.Admin.manage.init();
  });
});
