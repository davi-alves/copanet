// Generated by CoffeeScript 1.4.0

define(['jquery', 'index', 'jquery-ui', 'dropbox', 'fancybox', 'blockUI'], function(jQuery, Index) {
  Index = Index || {};
  Index.Admin = (function(Admin, jQuery) {
    Admin.manage = (function() {
      var bindEvents, confirmDelete, remove, uiBlocker, __deleteButton, __fancyboxImage, __uiBlock;
      __fancyboxImage = '.image-fancybox';
      __deleteButton = '.btn-remove';
      __uiBlock = false;
      confirmDelete = function(target) {
        var id, modal;
        id = $(target).closest('td').find(__deleteButton).attr('rel');
        modal = $(Index.modals.confirm);
        $('#modalBody', modal).html('Deseja deletar o item?');
        $('#modalLabel', modal).html('Deletar');
        $(modal).modal();
        $(modal).on('hidden', function() {
          return $(this).remove('.modal');
        });
        return $(modal).find('.btn-confirm-modal').bind('click', function() {
          $(modal).modal('hide');
          return remove(id);
        });
      };
      remove = function(id) {
        return $.ajax({
          url: Index.ajaxUrl,
          type: 'post',
          dataType: 'json',
          data: {
            id: id,
            ajaxAction: 'delete'
          },
          beforeSend: function() {
            return uiBlocker();
          }
        }).done(function(data) {
          var title;
          if (!(data instanceof Object)) {
            return false;
          }
          if (data.success === true) {
            title = 'Sucesso!';
          } else {
            title = false;
          }
          Index.modals.showAlert(data.message, title);
          if (data.success === true) {
            return setTimeout(function() {
              return window.location.href = document.URL;
            }, 2000);
          }
        }).always(function() {
          return uiBlocker();
        });
      };
      uiBlocker = function() {
        if (!__uiBlock) {
          $.blockUI({
            baseZ: 2000,
            css: {
              border: 'none',
              padding: '15px',
              backgroundColor: '#000',
              '-webkit-border-radius': '10px',
              '-moz-border-radius': '10px',
              opacity: .5,
              color: '#fff'
            },
            message: 'Aguarde...'
          });
          return __uiBlock = true;
        } else {
          $.unblockUI();
          return __uiBlock = false;
        }
      };
      bindEvents = function() {
        $(__deleteButton).bind('click', function(event) {
          event.preventDefault();
          return confirmDelete(event.target);
        });
        return $(__fancyboxImage).fancybox();
      };
      return {
        init: function() {
          return bindEvents();
        }
      };
    })();
    return Admin;
  })(Index || {}, jQuery);
  return jQuery(function() {
    return Index.Admin.manage.init();
  });
});
